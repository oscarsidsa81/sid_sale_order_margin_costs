<odoo>
    <data>

        <!--SALE ORDER - FORM 	model="ir.ui.view" 	sale.order.form márgen y costes adicionales-->

        <record id="sid_sale_order_margin_costs.form" model="ir.ui.view">
            <field name="name">sid_sale_order_margin_costs.form</field>
            <field name="model">sale.order</field>
            <field name="priority" eval="3002"/>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='tax_totals_json']" position="after">
                    <field name="costes_adicionales" string="Costes adicionales"
                           attrs="{'readonly': [('state', 'not in', ['draft', 'sent'])]}"/>
                    <field name="margen_neto" string="Margen neto" widget="percentage"/>
                </xpath>
                <!-- Elimina el botón “Confirm” que solo aparece en SENT -->
                <xpath expr="//form/header/button[@name='action_confirm' and contains(@attrs, &quot;'sent'&quot;)]"
                       position="replace"/>

                <!-- Elimina el botón “Confirm” que solo aparece en DRAFT -->
                <xpath expr="//form/header/button[@name='action_confirm' and contains(@attrs, &quot;'draft'&quot;)]"
                       position="replace"/>
                <!-- 2) Añadir nuestras dos variantes -->
                <xpath expr="//header" position="inside">
                    <!-- Con costes (visible si state in draft/sent Y costes > 0) -->
                    <button name="action_confirm"
                            type="object"
                            class="btn-primary"
                            string="Confirmar"
                            data-hotkey="v"
                            attrs="{'invisible': ['|',
                  ('state','not in',['draft','sent']),
                  ('costes_adicionales','&lt;=', 0)
              ]}"
                            confirm="¿Está seguro de confirmar el pedido?"/>

                    <!-- Sin costes (visible si state in draft/sent Y costes ≤ 0) -->
                    <button name="action_confirm"
                            type="object"
                            class="btn-primary"
                            string="Confirmar"
                            data-hotkey="v"
                            attrs="{'invisible': ['|',
                  ('state','not in',['draft','sent']),
                  ('costes_adicionales','&gt;', 0)
              ]}"
                            confirm="¿Está seguro de confirmar el pedido? No ha definido costes adicionales."/>
                </xpath>
            </field>
        </record>
    </data>
</odoo>


        <!-- METER EN OTRA FUNCIÓN DE CANCELACIONES JUNTO CON LÍNEAS DE VENTA Y COMPRA
                        &lt;!&ndash; Cancelar con textos distintos según estado &ndash;&gt;
                        <xpath expr="//form/header/button[@name='action_cancel']" position="replace">
                            &lt;!&ndash; Cancelar oferta (borrador/enviada) &ndash;&gt;
                            <button name="action_cancel"
                                    type="object"
                                    string="Cancelar"
                                    data-hotkey="z"
                                    attrs="{'invisible': [('state','not in',['draft','sent'])]}"
                                    confirm="¿Está seguro de cancelar el pedido? Recuerde que, si hay movimientos de stock confirmados o
                    facturas emitidas, no debe cancelar hasta devolver las unidades o rectificar las facturas."/>
                            &lt;!&ndash; Cancelar pedido confirmado &ndash;&gt;
                            <button name="action_cancel"
                                    type="object"
                                    string="Cancelar"
                                    data-hotkey="z"
                                    attrs="{'invisible': [('state','!=','sale')]}"
                                    confirm="¿Está seguro de cancelar esta oferta?"/>
                        </xpath>
        -->